<!DOCTYPE html>
<html lang="en"><head>
<title>EVE Planetary Interaction Chart</title>
<link rel="stylesheet" href="../assets/awsm_theme_black.min.css">
<meta charset="utf-8"/>
<style>
.viewport {
  text-align: center;
  padding-top: 10px;
}
h1 { margin-top: 0;}
h1, h2, h3 { padding-bottom: 5px; }
.mid-sized {
  width: 460px;
  margin: auto;
}
.example, .todos, #output-p2-summary, #output-p3-summary, #output-p3-summary-2 {
  width: 460px;
  text-align: left;
  margin: auto;
  padding: 10px;
}
#mats {
  font-size: small;
}
.bg-grey {
  background-color: #444444;
}
.buttons {
  clear: both;
  padding-top: 10px;
}
#single-planets-container, #output-container {
  display: none;
}
#single-planets {
  width: 460px;
  margin: auto;
}
input[type=text] { width: 300px; }
input[type=text].p-name { width: 50px; float: left; }
input[type=text].p-type { width: 70px; float: left; }
input[type=text].p-search { width: 340px; float: left; }

textarea {
 width: 80%;
 height: 400px;
 margin: auto;
}
.paste {
  height: 120px;
}
#go {
  background-color: rgb(82, 109, 42);
}
</style>
</head>
<body><div class="viewport">

<h1>EVE Planetary Interaction Chart</h1>
<div>
  <p>
  When deciding where set up my PI in a constellation I wanted<br>
  to choose a semi-good setup of what P1 and P2 to setup and<br>
  minimize shuttling P1 from planet to planet.<br>
  This tool will recommend what P2/P3 you can produce on a single planet.<br>
  </p>
  <p>
  To get the input, go to the Agency window ingame,<br>
  then Planetary Interaction and write down the percentages.
  </p>
</div>

<div class="mid-sized">
  <h2>Example input notation</h2>
  <div class="example bg-grey">
    <p>
    <strong>1G AL 59	IS 57	RG 30	BM 62	NG 66</strong><br>
    <strong>2b al 20 hm 40&#9;bm30</strong><br>
    </p>
    2 = Planet 2<br>
    b = Barren<br>
    20/40/30 = x% according to Agency or scanning<br>
    <div id="mats"></div>
    (everything is case insensitive)
  </div>
</div>

<div>
  <h2>Paste your survey here</h2>
  <textarea type="text" class="paste mid-sized" value=""></textarea><br>
  <div class="buttons">
    <input type="button" id="import" value="import" />
  </div>
  <hr>
</div>

<div id="single-planets-container">
  <h2>Breakdown</h2>
  <div id="single-planets"></div>
  <div class="buttons">
    <input type="button" id="go" value="go" /><br />
  </div>
  <hr>
</div>

<div id="output-container">
  <h2>Results</h2>
  <!--<h3>P1</h3>
    <textarea id="output-p1"></textarea>-->
  <h3>P3 - Summary</h3>
  <table><tr><td>
  <div id="output-p3-summary"></div>
  </td><td>
  <div id="output-p3-summary-2"></div>
  </td></tr></table>
  <h3>P2 - Summary</h3>
  <div id="output-p2-summary"></div>
  <h3>P3 - Details</h3>
  <textarea id="output-p3"></textarea>
  <h3>P2 - Details</h3>
  <textarea id="output-p2"></textarea>
</div>

<h2>Changes, TODOs, etc</h2>
<div class="todos">
<ul>
  <li>2021-04-02: added summary for P2/P3</li>
  <li>2021-03-21: added shortcut explanation</li>
  <li>2021-03-18: new CSS, some layout changes, split P2/P3</li>
  <li>2021-03-17: added intro, changes, todos</li>
  <li>2021-03-16: revamped layout, added examples</li>
  <li>2020-05: first version</li>
</ul>

<ul>
  <li>TODO: clarify P3 output on single planet</li>
  <li>TODO: allow cross-planet calculations</li>
</ul>
</div>

  </div>
<script src="../assets/zepto.min.js"></script>
<script type="text/javascript">
var roman = [
  "0", "I", "II", "III", "IV", "V",
  "VI", "VII", "VIII", "IX", "X",
  "XI", "XII", "XIII", "XIV", "XV"
];
var planets = [];

function out0(sel, text) {
  var old = $(sel).val();
  $(sel).text(old + text);
}
function out2(text) {
  out0('#output-p2', text + "\n");
}
function out3(text) {
  out0('#output-p3', text + "\n");
}

// set up stuff for lookup and data
var ps = [];
var p0 = {};
var p1 = {};
var p2 = {};
var p3 = {};
var p4 = {};

var ptypes = {};
ptypes['B'] = 'Barren';
ptypes['G'] = 'Gas';
ptypes['I'] = 'Ice';
ptypes['L'] = 'Lava';
ptypes['O'] = 'Oceanic';
ptypes['P'] = 'Plasma';
ptypes['S'] = 'Storm';
ptypes['T'] = 'Temperate';

ps[0] = 'AL';
ps[1] = 'AU';
ps[2] = 'BM';
ps[3] = 'CC';
ps[4] = 'CO';
ps[5] = 'FM';
ps[6] = 'HM';
ps[7] = 'IS';
ps[8] = 'MO';
ps[9] = 'NG';
ps[10] = 'NM';
ps[11] = 'NC';
ps[12] = 'PO';
ps[13] = 'RG';
ps[14] = 'SP';

p0[0] = 'Aqueous Liquids';
p0[1] = 'Autotrophs';
p0[2] = 'Base Metals';
p0[3] = 'Carbon Compounds';
p0[4] = 'Complex Organisms';
p0[5] = 'Felsic Magma';
p0[6] = 'Heavy Metals';
p0[7] = 'Ionic Solutions';
p0[8] = 'Micro Organisms';
p0[9] = 'Noble Gas';
p0[10] = 'Noble Metals';
p0[11] = 'Non-CS Crystals';
p0[12] = 'Planktic Colonies';
p0[13] = 'Reactive Gas';
p0[14] = 'Suspended Plasma';

p1['Aqueous Liquids'] = 'Water';
p1['Autotrophs'] = 'Industrial Fibers';
p1['Base Metals'] = 'Reactive Metals';
p1['Carbon Compounds'] = 'Biofuels';
p1['Complex Organisms'] = 'Proteins';
p1['Felsic Magma'] = 'Silicon';
p1['Heavy Metals'] = 'Toxic Metals';
p1['Ionic Solutions'] = 'Electrolytes';
p1['Micro Organisms'] = 'Bacteria';
p1['Noble Gas'] = 'Oxygen';
p1['Noble Metals'] = 'Precious Metals';
p1['Non-CS Crystals'] = 'Chiral Structures';
p1['Planktic Colonies'] = 'Biomass';
p1['Reactive Gas'] = 'Oxidizing Compound';
p1['Suspended Plasma'] = 'Plasmoids';

p2['Biocells'] = ['Biofuels', 'Precious Metals'];
p2['Construction Blocks'] = ['Reactive Metals', 'Toxic Metals'];
p2['Consumer Electronics'] = ['Chiral Structures', 'Toxic Metals'];
p2['Coolant'] = ['Electrolytes', 'Water'];
p2['Enriched Uranium'] = ['Precious Metals', 'Toxic Metals'];
p2['Fertilizer'] = ['Bacteria', 'Proteins'];
p2['Genetically Enhanced Livestock'] = ['Biomass', 'Proteins'];
p2['Livestock'] = ['Biofuels', 'Proteins'];
p2['Mechanical Parts'] = ['Precious Metals', 'Reactive Metals'];
p2['Miniature Electronics'] = ['Chiral Structures', 'Silicon'];
p2['Microfiber Shielding'] = ['Industrial Fibers', 'Silicon'];
p2['Nanites'] = ['Bacteria', 'Reactive Metals'];
p2['Oxides'] = ['Oxidizing Compound', 'Oxygen'];
p2['Polyaramids'] = ['Industrial Fibers', 'Oxidizing Compund'];
p2['Polytextiles'] = ['Biofuels', 'Industrial Fibers'];
p2['Rocket Fuel'] = ['Electrolytes', 'Plasmoids'];
p2['Silicate Glass'] = ['Oxidizing Compund', 'Silicon'];
p2['Superconductors'] = ['Plasmoids', 'Water'];
p2['Supertensile Plastics'] = ['Biomass', 'Oxygen'];
p2['Synthetic Oil'] = ['Electrolytes', 'Oxygen'];
p2['Test Cultures'] = ['Bacteria', 'Water'];
p2['Transmitter'] = ['Chiral Structures', 'Plasmoids'];
p2['Viral Agent'] = ['Bacteria', 'Biomass'];
p2['Water-Cooled CPU'] = ['Reactive Metals', 'Water'];

p3['Biotech Research Reports'] = ['Nanites', 'Livestock', 'Construction Blocks'];
p3['Camera Drones'] = ['Silicate Glass', 'Rocket Fuel'];
p3['Condensates'] = ['Oxides', 'Coolant'];
p3['Cryoprotectant Solution'] = ['Test Cultures', 'Synthetic Oil', 'Fertilizer'];
p3['Data Chips'] = ['Supertensile Plastics', 'Microfiber Shielding'];
p3['Gel-Matrix Biopaste'] = ['Oxides', 'Biocells', 'Superconductors'];
p3['Guidance Systems'] = ['Water-Cooled CPU', 'Transmitter'];
p3['Hazmat Detection Systems'] = ['Polytextiles', 'Viral Agent', 'Transmitter'];
p3['Hermetic Membranes'] = ['Polyaramids', 'Genetically Enhanced Livestock'];
p3['High-Tech Transmitters'] = ['Polyaramids', 'Transmitter'];
p3['Industrial Explosives'] = ['Fertilizer', 'Polytextiles'];
p3['Neocoms'] = ['Biocells', 'Silicate Glass'];
p3['Nuclear Reactors'] = ['Microfiber Shielding', 'Enriched Uranium'];
p3['Planetary Vehicles'] = ['Supertensile Plastics', 'Mechanical Parts', 'Miniature Electronics'];
p3['Robotics'] = ['Mechanical Parts', 'Consumer Electronics'];
p3['Smartfab Units'] = ['Construction Blocks', 'Miniature Electronics'];
p3['Supercomputers'] = ['Water-Cooled CPU', 'Coolant', 'Consumer Electronics'];
p3['Synthetic Synapses'] = ['Supertensile Plastics', 'Test Cultures'];
p3['Transcranial Microcontroller'] = ['Biocells', 'Nanites'];
p3['Ukomi Super Conductor'] = ['Synthetic Oil', 'Superconductors'];
p3['Vaccines'] = ['Livestock', 'Viral Agent'];

p4['Broadcast Node'] = ['Neocoms', 'Data Chips', 'High-Tech Transmitters'];
p4['Integrity Response Drones'] = ['Gel-Matrix Biopaste', 'Hazmat Detection Systems', 'Planetary Vehicles'];
p4['Nano-Factory'] = ['Industrial Explosives', 'Ukomi Super Conductors', '40 Reactive Metals'];
p4['Organic Mortar Applicators'] = ['Condensates', 'Robotics', '40 Bacteria'];
p4['Recursive Computing Module'] = ['Synthetic Synapses', 'Guidance Systems', 'Transcranial Microcontrollers'];
p4['Self-Harmonizing Power Core'] = ['Camera Drones', 'Nuclear Reactors', 'Hermetic Membranes'];
p4['Sterile Conduits'] = ['40 Water', 'Smartfab Units', 'Vaccines'];
p4['Wetware Mainframe'] = ['Supercomputers', 'Biotech Research Reports', 'Cryoprotectant Solution'];

Zepto(function($){
for (var im=0; im<ps.length; ++im) {
  var row = ps[im] + " = " + p0[im] + "<br>";
  $("#mats").append(row);
}
});
// the import button
$('#import').on('click', function(e){
  var pasted = $('.paste').val().trim();
  if (pasted.length < 1) return;
  planets = [];
  $("#single-planets").empty();
  $("#single-planets-container").show();

  var lines = pasted.split("\n");
  var re = /(\d+)(\s*([bgilopst])\s+)(.+)/i;
  $.each(lines, function(k, v) {
    v = v.trim();
    if (v.length < 1 || v.substring(0, 1) == '#') return;
    var m = v.match(re);
    //console.log(m);
    if (m.length == 5) {
      var idx = parseInt(m[1]);
      var ptype = m[3].toUpperCase();
      var text = m[4].toUpperCase().replace(/(\s+)/g, ' ');

      var p = {idx: idx, type: ptypes[ptype], value: text, name: roman[idx]};
      planets.push(p);
      var row = '<div>'
        + '<input type="text" class="p-name"   disabled="disabled" value="'+p.name+'" />'
        + '<input type="text" class="p-type "  disabled="disabled" value="'+p.type+'" />'
        + '<input type="text" class="p-search" disabled="disabled" value="'+p.value+'" /></div>';
      $("#single-planets").append(row);
    }
  });
  //console.log(planets);
});


// the actual calculation
$('#go').on('click', function(e){
  $("#output-p2-summary").empty();
  $("#output-p3-summary").empty();
  $("#output-p3-summary-2").empty();
  $("#output-p2").empty();
  $("#output-p3").empty();
  $("#output-container").show();
  for (var ip=0; ip<planets.length; ++ip) {

// read inputs and parse
var val = planets[ip].value;
if (val.length <1) continue;
var name = planets[ip].name;
var r0 = [];
var r1 = [];
var amounts0 = {};
var amounts1 = {};

for (var i=0; i<ps.length; i++) {
  let re = new RegExp("(" + ps[i] + ")\\s*(\\w+)");
  let found = val.match(re);
  if (found && found.length > 0) {
    p0x = p0[i];
    amounts0[p0x] = found[2];
    amounts1[p1[p0x]] = found[2];
    r0.push(p0x);
    r1.push(p1[p0x]);
  }
}

// generate output
if (ip > 0) {
  out2("");
  out3("");
}
out2("================== Planet " + name + " ================\n");
out3("================== Planet " + name + " ================\n");

var match1 = [];
var match2 = [];
var match3 = [];
var match3_m = [];

// see if we have all needed P1 materials per P2
$.each(p2, function(k, v) {
  var ok = [];
  $.each(p2[k], function(k2, v2) {
    if ($.inArray(v2, r1) > -1)  {
      ok.push(k);
    }
  });
  if (ok.length == 2) match2.push(k);
  else if (ok.length == 1) match1.push(k);
});

// show 2/2 P2 and calculate average
var p2_summary = "";
$.each(match2, function(k, v) {
  out2("P2 (2/2): " + v);
  var avg = 0;
  $.each(p2[v], function(k2, v2) {
    out2("  " + v2 + " :: " + amounts1[v2]);
    avg = avg + parseInt(amounts1[v2]);
  });
  out2("Average: " + (avg/2));
  p2_summary += "<li>" + name + " :: " + "P2 :: " + v + ": " + (avg/2) + "</li>"
});
if (p2_summary != "") {
  $("#output-p2-summary").append("<ul>" + p2_summary + "</ul>");
}

// show 1/2 P2
if (match1.length > 0) out2("\n-------\n");
$.each(match1, function(k, v) {
  out2("P2 (1/2): " + v);
  $.each(p2[v], function(k2, v2) {
    if (amounts1[v2] !== undefined) {
      out2("  " + v2 + " :: " + amounts1[v2]);
    } else {
      out2("  " + v2 + " :: 0");
    }
  });
});

// calculate P3
$.each(p3, function (k, v) {
  var ok = [];
  $.each(p3[k], function(k2, v2) {
    if ($.inArray(v2, match2) > -1) {
      ok.push(k);
    }
  });
  if (ok.length == p3[k].length) match3.push(k);
  else if (ok.length > 0) match3_m.push(k);
});

// show (unlikely) 2/2 and 3/3 P3 and calculate average
var p3_summary = "";
$.each(match3, function(k, v) {
  var line = "P3 (2/2): " + v + " =<br>";
  out3("P3 (2/2): " + v);
  $.each(p3[v], function(k2, v2) {
    out3("  " + v2 + " " );
  });
  line += p3[v].join(" / ");
  out3("");
  p3_summary += "<li>" + name + " :: " + line + "" + "</li>";
});

// show 1/2 P3
if (match3_m.length > 0 && match3.length > 0) out3("\-------\n");
//if (match3_m.length > 0 && match3.length > 0) $("#output-p3-summary").append("<ul>");
var p3_summary_2 = "";
console.log(match3_m);
$.each(match3_m, function(k, v) {
  var line = "P3 (1/x): " + v + " =<br>";
  out3("P3 (1/x): " + v);
  //console.log(name, v, match2);
  $.each(p3[v], function(k2, v2) {
    //console.log("x " + k2 + " " + v2);
    if ($.inArray(v2, match2) > 0) {
      out3("  " + v2 + " :: 1");
      line += " " + v2;
    } else {
      out3("  " + v2 + " :: 0");
    }
  });
  //$("#output-p3-summary").append("<li>" + name + " :: " + line + "" + "</li>");
  p3_summary_2 = "<li>" + name + " :: " + line + "" + "</li>";
});
//if (match3.length > 0) $("#output-p3-summary").append("</ul>");
if (p3_summary != "") {
  $("#output-p3-summary").append("<ul>" + p3_summary + "</ul>");
}
if (p3_summary_2 != "") {
  $("#output-p3-summary-2").append("<ul>" + p3_summary_2 + "</ul>");
}

  }
});
</script>
</body></html>
